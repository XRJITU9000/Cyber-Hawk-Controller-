<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CYBER HAWK Genesis Edition</title>

<style>
body{
    margin:0;
    background:#000;
    color:white;
    font-family:Arial, sans-serif;
    overflow:hidden;
}

.header{
    height:60px;
    background:#0a0a0a;
    border-bottom:2px solid #ffcc00;
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:0 20px;
    box-shadow:0 0 20px #ffcc00 inset;
}

.header h1{
    margin:0;
    font-size:22px;
    color:#ffcc00;
    letter-spacing:2px;
}

.container{
    display:flex;
    height:calc(100vh - 60px);
}

.joystick{
    flex:1;
    display:flex;
    justify-content:center;
    align-items:center;
}

.base{
    width:200px;
    height:200px;
    background:#111;
    border-radius:50%;
    border:3px solid #ffcc00;
    position:relative;
    touch-action:none;
    box-shadow:0 0 25px #ffcc00;
}

.knob{
    width:80px;
    height:80px;
    background:#ffcc00;
    border-radius:50%;
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    box-shadow:0 0 30px #ffcc00;
}

.center{
    flex:2;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:space-around;
}

.video-container{
    position:relative;
    width:520px;
    height:520px;
    background:black;
    border:3px solid #ffcc00;
    border-radius:20px;
    box-shadow:0 0 40px #ffcc00;
    overflow:hidden;
}

video{
    position:absolute;
    width:100%;
    height:100%;
    object-fit:cover;
}

#horizon{
    position:absolute;
    width:100%;
    height:100%;
    pointer-events:none;
}

/* SIGNAL ‚Äî EXTREME RIGHT */
.signal-box{
    position:absolute;
    top:10px;
    right:10px;
    background:rgba(0,0,0,0.6);
    border:2px solid #ffcc00;
    padding:6px 10px;
    border-radius:10px;
    font-size:12px;
    box-shadow:0 0 15px #ffcc00;
}

.signal-bars{
    display:flex;
    gap:3px;
    margin-top:4px;
}

.signal-bars div{
    width:6px;
    background:#ffcc00;
    opacity:0.3;
}

.bar1{height:6px;}
.bar2{height:10px;}
.bar3{height:14px;}
.bar4{height:18px;}

.button-row{
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    gap:10px;
}

button{
    padding:10px 16px;
    background:#111;
    color:white;
    border:2px solid #ffcc00;
    border-radius:12px;
    cursor:pointer;
}

button:active{
    transform:scale(0.95);
    background:#222;
}

.dashboard{
    display:flex;
    justify-content:space-around;
    width:95%;
}

.panel{
    background:#111;
    padding:6px 10px;
    border:2px solid #ffcc00;
    border-radius:10px;
    text-align:center;
    min-width:90px;
    box-shadow:0 0 15px #ffcc00;
}

.bar{
    height:12px;
    background:#222;
    border-radius:6px;
    margin-top:5px;
    overflow:hidden;
}

.fill{
    height:100%;
    background:#ffcc00;
    width:0%;
}
</style>
</head>

<body>

<div class="header">
    <h1>üöÅ CYBER HAWK Genesis Edition</h1>
    <div style="display:flex;align-items:center;gap:8px;">
        <div id="statusLight" style="width:14px;height:14px;border-radius:50%;background:red;box-shadow:0 0 10px red;"></div>
        <div id="statusText">DISCONNECTED</div>
    </div>
</div>

<div class="container">

<div class="joystick">
    <div class="base" id="leftBase">
        <div class="knob" id="leftKnob"></div>
    </div>
</div>

<div class="center">

<div class="video-container">
    <video id="stream" autoplay muted></video>
    <canvas id="horizon"></canvas>

    <div class="signal-box">
        üì° SIGNAL
        <div class="signal-bars">
            <div class="bar1"></div>
            <div class="bar2"></div>
            <div class="bar3"></div>
            <div class="bar4"></div>
        </div>
    </div>
</div>

<div class="button-row">
    <button onclick="sendCommand('ARM')">ARM</button>
    <button onclick="sendCommand('DISARM')">DISARM</button>
    <button onclick="sendCommand('LED')">LED</button>
    <button onclick="sendCommand('HOVER')">HOVER</button>
    <button onclick="sendCommand('RTH')">RTH</button>
</div>

<div class="button-row">
    <button onclick="sendCommand('FLIP_FRONT')">FRONT FLIP</button>
    <button onclick="sendCommand('FLIP_BACK')">BACK FLIP</button>
    <button onclick="capturePhoto()">üì∏ PHOTO</button>
    <button id="recordBtn">üî¥ RECORD</button>
</div>

<div class="dashboard">
    <div class="panel">
        Battery
        <div class="bar"><div id="batFill" class="fill"></div></div>
        <span id="battery">100%</span>
    </div>
    <div class="panel">
        Altitude
        <div class="bar"><div id="altFill" class="fill"></div></div>
        <span id="altitude">0m</span>
    </div>
    <div class="panel">
        Mode
        <div id="mode">STANDBY</div>
    </div>
</div>

</div>

<div class="joystick">
    <div class="base" id="rightBase">
        <div class="knob" id="rightKnob"></div>
    </div>
</div>

</div>

<script>
const serverUrl="http://192.168.4.1";
document.getElementById("stream").src=serverUrl+"/stream";

const statusLight=document.getElementById("statusLight");
const statusText=document.getElementById("statusText");

function checkConnection(){
    fetch(serverUrl,{mode:"no-cors"})
    .then(()=>{
        statusLight.style.background="lime";
        statusLight.style.boxShadow="0 0 15px lime";
        statusText.innerText="CONNECTED";
    })
    .catch(()=>{
        statusLight.style.background="red";
        statusLight.style.boxShadow="0 0 15px red";
        statusText.innerText="DISCONNECTED";
    });
}
setInterval(checkConnection,3000);
checkConnection();

let hoverMode=false;
let batteryLevel=100;
let throttleValue=0;
let altitude=0;

function sendCommand(cmd){
    if(cmd==="HOVER"){
        hoverMode=!hoverMode;
        document.getElementById("mode").innerText=hoverMode?"HOVER":"STANDBY";
    }

    if(cmd==="RTH"){
        document.getElementById("mode").innerText="RETURNING";
        let interval=setInterval(()=>{
            altitude-=1;
            if(altitude<=0){
                altitude=0;
                document.getElementById("mode").innerText="LANDED";
                clearInterval(interval);
            }
        },100);
    }

    fetch(serverUrl+"/command?cmd="+cmd).catch(()=>{});
}

/* BATTERY */
setInterval(()=>{
    if(batteryLevel>0) batteryLevel-=0.05;
    document.getElementById("battery").innerText=Math.floor(batteryLevel)+"%";
    document.getElementById("batFill").style.width=batteryLevel+"%";
    if(batteryLevel<20){
        document.getElementById("batFill").style.background="red";
    }
},1000);

/* ALTITUDE */
setInterval(()=>{
    altitude+=throttleValue*0.5;
    if(altitude<0) altitude=0;
    if(altitude>100) altitude=100;
    document.getElementById("altitude").innerText=altitude.toFixed(1)+"m";
    document.getElementById("altFill").style.width=altitude+"%";
},200);

/* SIGNAL */
const bars=document.querySelectorAll(".signal-bars div");
setInterval(()=>{
    const strength=statusText.innerText==="CONNECTED"
        ?Math.floor(Math.random()*4)+1
        :0;
    bars.forEach((bar,index)=>{
        bar.style.opacity=index<strength?1:0.3;
    });
},800);

/* JOYSTICKS */
let roll=0;
let pitch=0;

function setupJoystick(baseId,knobId,axisX,axisY){
    const base=document.getElementById(baseId);
    const knob=document.getElementById(knobId);
    let pointerId=null;
    const max=70;

    base.addEventListener("pointerdown",e=>{
        pointerId=e.pointerId;
        base.setPointerCapture(pointerId);
    });

    base.addEventListener("pointermove",e=>{
        if(e.pointerId!==pointerId) return;
        const rect=base.getBoundingClientRect();
        let x=e.clientX-(rect.left+rect.width/2);
        let y=e.clientY-(rect.top+rect.height/2);
        const dist=Math.sqrt(x*x+y*y);
        if(dist>max){
            x=(x/dist)*max;
            y=(y/dist)*max;
        }
        knob.style.transform=`translate(-50%,-50%) translate(${x}px,${y}px)`;

        if(axisX==="pitch"){
            pitch=hoverMode?0:(-y/max)*80;
            roll=hoverMode?0:(x/max);
        }

        if(axisX==="throttle"){
            throttleValue=-y/max;
        }

        fetch(serverUrl+`/joystick?${axisX}=${x/max}&${axisY}=${-y/max}`);
    });

    base.addEventListener("pointerup",e=>{
        if(e.pointerId!==pointerId) return;
        pointerId=null;
        knob.style.transform="translate(-50%,-50%)";
        fetch(serverUrl+`/joystick?${axisX}=0&${axisY}=0`);
        pitch=0;
        roll=0;
    });
}

setupJoystick("leftBase","leftKnob","pitch","roll");
setupJoystick("rightBase","rightKnob","throttle","yaw");

/* ARTIFICIAL HORIZON v4.4 */
const canvas=document.getElementById("horizon");
const ctx=canvas.getContext("2d");

function resizeCanvas(){
    canvas.width=canvas.offsetWidth;
    canvas.height=canvas.offsetHeight;
}
resizeCanvas();
window.addEventListener("resize",resizeCanvas);

function drawHorizon(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    const cx=canvas.width/2;
    const cy=canvas.height/2;

    ctx.save();
    ctx.translate(cx,cy);
    ctx.rotate(roll);

    ctx.fillStyle="#000";
    ctx.fillRect(-canvas.width*2,-canvas.height*2,canvas.width*4,canvas.height*4);

    ctx.strokeStyle="#ffcc00";
    ctx.lineWidth=3;
    ctx.shadowBlur=25;
    ctx.shadowColor="#ffcc00";

    ctx.beginPath();
    ctx.moveTo(-canvas.width,pitch);
    ctx.lineTo(canvas.width,pitch);
    ctx.stroke();

    ctx.lineWidth=2;
    ctx.font="bold 14px Arial";
    ctx.fillStyle="#ffcc00";

    for(let i=-50;i<=50;i+=10){
        let y=pitch+i*4;
        ctx.beginPath();
        ctx.moveTo(-60,y);
        ctx.lineTo(60,y);
        ctx.stroke();
        if(i!==0){
            ctx.fillText(i,70,y+4);
            ctx.fillText(i,-90,y+4);
        }
    }

    ctx.restore();

    ctx.strokeStyle="#ffcc00";
    ctx.lineWidth=4;
    ctx.shadowBlur=30;

    ctx.beginPath();
    ctx.moveTo(cx-40,cy);
    ctx.lineTo(cx-10,cy);
    ctx.moveTo(cx+10,cy);
    ctx.lineTo(cx+40,cy);
    ctx.moveTo(cx,cy);
    ctx.lineTo(cx,cy+15);
    ctx.stroke();

    ctx.beginPath();
    ctx.arc(cx,cy,canvas.width/2-25,Math.PI*1.1,Math.PI*1.9);
    ctx.lineWidth=2;
    ctx.stroke();

    requestAnimationFrame(drawHorizon);
}
drawHorizon();
</script>

</body>
        </html>
