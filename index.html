<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CYBER HAWK v4.1</title>

<style>
body{
    margin:0;
    background:#0a0a0a;
    color:white;
    font-family:Arial, sans-serif;
    overflow:hidden;
}

/* HEADER */
.header{
    height:60px;
    background:#111;
    border-bottom:2px solid #ffcc00;
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:0 20px;
    box-shadow:0 0 15px #ffcc00 inset;
}

.header h1{
    margin:0;
    font-size:22px;
    color:#ffcc00;
    letter-spacing:2px;
}

.status{
    display:flex;
    align-items:center;
    gap:8px;
    font-size:14px;
}

.dot{
    width:10px;
    height:10px;
    border-radius:50%;
    background:lime;
    box-shadow:0 0 8px lime;
}

/* MAIN */
.container{
    display:flex;
    height:calc(100vh - 60px);
}

/* JOYSTICKS */
.joystick{
    flex:1;
    display:flex;
    justify-content:center;
    align-items:center;
}

.base{
    width:200px;
    height:200px;
    background:#222;
    border-radius:50%;
    border:3px solid #ffcc00;
    position:relative;
    touch-action:none;
}

.knob{
    width:80px;
    height:80px;
    background:#ffcc00;
    border-radius:50%;
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%) translate(0px,0px);
    box-shadow:0 0 20px #ffcc00;
    transition:transform 0.05s linear;
}

/* CENTER */
.center{
    flex:2;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:space-around;
    background:#111;
    padding:10px;
    border-left:2px solid #444;
    border-right:2px solid #444;
}

video{
    width:90%;
    border:3px solid #ffcc00;
    border-radius:10px;
}

/* BUTTONS */
.button-row{
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    gap:10px;
}

button{
    padding:10px 16px;
    background:#222;
    color:white;
    border:2px solid #ffcc00;
    border-radius:12px;
    font-size:14px;
    cursor:pointer;
}

button:active{
    background:#333;
    transform:scale(0.95);
}

/* DASHBOARD */
.dashboard{
    display:flex;
    justify-content:space-around;
    width:95%;
}

.panel{
    background:#222;
    padding:6px 10px;
    border:2px solid #ffcc00;
    border-radius:8px;
    text-align:center;
    min-width:90px;
}

.bar{
    height:12px;
    background:#333;
    border-radius:6px;
    margin-top:5px;
    overflow:hidden;
}

.fill{
    height:100%;
    background:#ffcc00;
    width:0%;
}
</style>
</head>

<body>

<div class="header">
    <h1>üöÅ CYBER HAWK v4.1</h1>
    <div class="status">
        <div class="dot"></div>
        CONNECTED
    </div>
</div>

<div class="container">

<!-- LEFT JOYSTICK -->
<div class="joystick">
    <div class="base" id="leftBase">
        <div class="knob" id="leftKnob"></div>
    </div>
</div>

<!-- CENTER PANEL -->
<div class="center">

    <video id="stream" autoplay muted></video>

    <div class="button-row">
        <button onclick="sendCommand('ARM')">ARM</button>
        <button onclick="sendCommand('DISARM')">DISARM</button>
        <button onclick="sendCommand('LED')">LED</button>
        <button onclick="sendCommand('HOVER')">HOVER</button>
        <button onclick="sendCommand('RTH')">RTH</button>
    </div>

    <div class="button-row">
        <button onclick="sendCommand('FLIP_FRONT')">FRONT FLIP</button>
        <button onclick="sendCommand('FLIP_BACK')">BACK FLIP</button>
        <button onclick="capturePhoto()">üì∏ PHOTO</button>
        <button onclick="toggleRecord()">‚è∫ RECORD</button>
    </div>

    <div class="dashboard">
        <div class="panel">
            Battery
            <div class="bar"><div id="batFill" class="fill"></div></div>
            <span id="battery">100%</span>
        </div>
        <div class="panel">
            Altitude
            <div class="bar"><div id="altFill" class="fill"></div></div>
            <span id="altitude">0m</span>
        </div>
        <div class="panel">
            Mode
            <div id="mode">STANDBY</div>
        </div>
        <div class="panel">
            Status
            <div id="status">OK</div>
        </div>
    </div>

</div>

<!-- RIGHT JOYSTICK -->
<div class="joystick">
    <div class="base" id="rightBase">
        <div class="knob" id="rightKnob"></div>
    </div>
</div>

</div>

<script>

const serverUrl="http://192.168.4.1";

document.getElementById("stream").src=serverUrl+"/stream";

function sendCommand(cmd){
    fetch(serverUrl+"/command?cmd="+cmd)
    .catch(err=>console.log(err));
}

function capturePhoto(){
    fetch(serverUrl+"/capture")
    .then(res=>res.blob())
    .then(blob=>{
        const url=URL.createObjectURL(blob);
        const a=document.createElement("a");
        a.href=url;
        a.download="cyberhawk.jpg";
        a.click();
    });
}

let recording=false;
function toggleRecord(){
    recording=!recording;
    if(recording){
        sendCommand("START_RECORD");
        alert("Recording Started");
    }else{
        sendCommand("STOP_RECORD");
        alert("Recording Stopped");
    }
}

function setupJoystick(baseId,knobId,axisX,axisY){

    const base=document.getElementById(baseId);
    const knob=document.getElementById(knobId);
    let pointerId=null;
    const max=70;

    base.addEventListener("pointerdown",e=>{
        pointerId=e.pointerId;
        base.setPointerCapture(pointerId);
    });

    base.addEventListener("pointermove",e=>{
        if(e.pointerId!==pointerId) return;

        const rect=base.getBoundingClientRect();
        let x=e.clientX-(rect.left+rect.width/2);
        let y=e.clientY-(rect.top+rect.height/2);

        const dist=Math.sqrt(x*x+y*y);
        if(dist>max){
            x=(x/dist)*max;
            y=(y/dist)*max;
        }

        knob.style.transform=`translate(-50%,-50%) translate(${x}px,${y}px)`;

        fetch(serverUrl+`/joystick?${axisX}=${x/max}&${axisY}=${-y/max}`);
    });

    base.addEventListener("pointerup",e=>{
        if(e.pointerId!==pointerId) return;
        pointerId=null;

        knob.style.transform="translate(-50%,-50%) translate(0px,0px)";
        fetch(serverUrl+`/joystick?${axisX}=0&${axisY}=0`);
    });
}

setupJoystick("leftBase","leftKnob","pitch","roll");
setupJoystick("rightBase","rightKnob","throttle","yaw");

/* Demo telemetry */
setInterval(()=>{
    const b=Math.floor(Math.random()*100);
    const a=Math.floor(Math.random()*50);

    document.getElementById("battery").innerText=b+"%";
    document.getElementById("batFill").style.width=b+"%";

    document.getElementById("altitude").innerText=a+"m";
    document.getElementById("altFill").style.width=(a*2)+"%";
},1000);

</script>

</body>
    </html>
